# 🔔 Управление уведомлениями (notifications)

## Обзор

Модуль `notifications` предоставляет инструменты для управления системой уведомлений SwiftDevBot, включая настройку каналов, отправку сообщений и мониторинг уведомлений.

## Основные команды

### `python sdb notifications list`

Показывает список настроенных каналов уведомлений.

**Опции:**
- `--enabled` - только активные каналы
- `--disabled` - только отключенные каналы
- `--detailed` - подробная информация
- `--json` - вывод в формате JSON

**Примеры:**

```bash
# Показать все каналы
python sdb notifications list

# Показать только активные
python sdb notifications list --enabled

# Подробная информация
python sdb notifications list --detailed
```

**Результат:**
```
📋 Список каналов уведомлений

✅ Активные каналы:
   📧 Email: admin@example.com
      📊 Статус: Активен
      📈 Последнее сообщение: 2 минуты назад
      📊 Успешных отправок: 1,250
      📊 Неудачных отправок: 5

   📱 Telegram: @admin_bot
      📊 Статус: Активен
      📈 Последнее сообщение: 5 минут назад
      📊 Успешных отправок: 850
      📊 Неудачных отправок: 2



📊 Статистика (24 часа):
   📈 Всего отправлено: 2,100 уведомлений
   ✅ Успешных: 2,098 (99.9%)
   ❌ Неудачных: 2 (0.1%)
   📊 Среднее время доставки: 2.3 секунды
```

### `python sdb notifications send --channel`

Отправляет тестовое уведомление в указанный канал.

**Опции:**
- `--channel CHANNEL` - канал для отправки
- `--message MESSAGE` - пользовательское сообщение
- `--priority high/medium/low` - приоритет уведомления
- `--all` - отправить во все каналы

**Примеры:**

```bash
# Отправить тест в email
python sdb notifications send --channel email

# Отправить в Telegram
python sdb notifications send --channel telegram

# Отправить во все каналы
python sdb notifications send --all

# Отправить с пользовательским сообщением
python sdb notifications send --channel telegram --message "Тестовое уведомление"
```

**Результат:**
```
📤 Отправка тестового уведомления

📋 Канал: email (admin@example.com)
📊 Приоритет: Нормальный
📋 Статус: Отправляется...

✅ Уведомление успешно отправлено
📊 Время доставки: 1.8 секунды
📅 Отправлено: 2024-01-15 14:35:22
📋 ID сообщения: msg_20240115_143522_001

📋 Детали отправки:
   📧 SMTP сервер: smtp.gmail.com
   📧 Порт: 587
   📧 Шифрование: TLS
   📧 Аутентификация: Успешно

📋 Содержание сообщения:
   📋 Тема: [SDB] Тестовое уведомление
   📋 От: SwiftDevBot <noreply@example.com>
   📋 Кому: admin@example.com
   📋 Время: 2024-01-15 14:35:22 UTC

📋 Рекомендации:
   ✅ Канал работает корректно
   📊 Время доставки в норме
   🔧 Можно использовать для критических уведомлений
```

### `python sdb notifications configure --email/telegram`

Настраивает каналы уведомлений.

**Опции:**
- `--email EMAIL` - настройка email
- `--telegram TOKEN` - настройка Telegram
- `--test` - протестировать после настройки

**Примеры:**

```bash
# Настроить email
python sdb notifications configure --email admin@example.com

# Настроить Telegram
python sdb notifications configure --telegram BOT_TOKEN



# Настроить с тестированием
python sdb notifications configure --email admin@example.com --test
```

**Результат:**
```
⚙️ Настройка канала уведомлений

📋 Канал: Email
📧 Адрес: admin@example.com
📋 Статус: Настройка...

📊 Проверка настроек:
   ✅ SMTP сервер доступен
   ✅ Аутентификация успешна
   ✅ SSL сертификат валиден
   ✅ Порт 587 открыт

✅ Канал успешно настроен
📊 Статус: Активен
📈 Приоритет: Высокий
📋 Типы уведомлений: Все

📋 Настройки SMTP:
   📧 Сервер: smtp.gmail.com
   📧 Порт: 587
   📧 Шифрование: TLS
   📧 Аутентификация: OAuth2

📋 Тестирование:
   ✅ Тестовое сообщение отправлено
   📊 Время доставки: 2.1 секунды
   📋 Статус: Успешно

📋 Рекомендации:
   ✅ Канал готов к использованию
   📊 Рекомендуется для критических уведомлений
   🔧 Настройте резервный канал
```

### `python sdb notifications test`

Тестирует все настроенные каналы уведомлений.

**Опции:**
- `--all` - тестировать все каналы
- `--channel CHANNEL` - тестировать конкретный канал
- `--verbose` - подробный вывод
- `--timeout SECONDS` - таймаут для тестов

**Примеры:**

```bash
# Тестировать все каналы
python sdb notifications test

# Тестировать конкретный канал
python sdb notifications test --channel email

# Подробное тестирование
python sdb notifications test --verbose
```

**Результат:**
```
🧪 Тестирование каналов уведомлений

📋 Тестируемые каналы:
   📧 Email: admin@example.com
   📱 Telegram: @admin_bot
   

📊 Результаты тестирования:

✅ Email (admin@example.com):
   ✅ Подключение: Успешно
   ✅ Аутентификация: Успешно
   ✅ Отправка: Успешно
   📊 Время доставки: 1.8 сек

✅ Telegram (@admin_bot):
   ✅ Подключение: Успешно
   ✅ Аутентификация: Успешно
   ✅ Отправка: Успешно
   📊 Время доставки: 0.5 сек



📊 Общая статистика:
   ✅ Успешных тестов: 2/2
   ❌ Неудачных тестов: 0/2
   📊 Среднее время доставки: 1.2 сек
   📈 Общий статус: Отлично

📋 Рекомендации:
   📊 Все каналы работают корректно
   ✅ Система готова к использованию
```

## Расширенные команды (в разработке)

### `python sdb notifications monitor --real-time`

Мониторинг уведомлений в реальном времени.

**Опции:**
- `--real-time` - мониторинг в реальном времени
- `--dashboard` - веб-интерфейс мониторинга
- `--alerts` - настройка алертов

**Примеры:**

```bash
# Мониторинг в реальном времени
python sdb notifications monitor --real-time

# Веб-интерфейс мониторинга
python sdb notifications monitor --dashboard

# Настройка алертов
python sdb notifications monitor --alerts
```

**Результат:**
```
📊 Мониторинг уведомлений в реальном времени

📋 Текущие метрики:
   📊 Активных каналов: 3
   📊 Уведомлений в очереди: 0
   📊 Среднее время доставки: 1.5 сек
   📊 Успешность доставки: 99.8%

📊 Статистика (24 часа):
   📈 Всего отправлено: 2,100 уведомлений
   ✅ Успешных: 2,098 (99.9%)
   ❌ Неудачных: 2 (0.1%)
   📊 По каналам:
      📧 Email: 1,250 (99.6%)
      📱 Telegram: 850 (99.8%)

🔔 Алерты:
   🟢 Все каналы работают нормально
   ⚠️ 1 неудачная отправка в email (5 мин назад)
   📊 Система стабильна

📋 Рекомендации:
   🔧 Проверьте настройки email при неудачах
   📊 Мониторьте производительность каналов
   🔄 Настройте автоматические повторы
```

### `python sdb notifications template --create`

Создание шаблонов уведомлений.

**Опции:**
- `--create` - создать шаблон
- `--list` - показать шаблоны
- `--edit` - редактировать шаблон
- `--delete` - удалить шаблон

**Примеры:**

```bash
# Создать шаблон
python sdb notifications template --create

# Показать шаблоны
python sdb notifications template --list

# Редактировать шаблон
python sdb notifications template --edit backup_success
```

**Результат:**
```
📝 Управление шаблонами уведомлений

📋 Создание шаблона:
   📝 Название: backup_success
   📝 Категория: Системные уведомления
   📝 Приоритет: Нормальный
   📝 Каналы: email, telegram

📋 Шаблон создан:
   📝 Тема: [SDB] Бэкап успешно создан
   📝 Содержание:
      Бэкап {backup_name} успешно создан
      📁 Размер: {size}
      ⏱️ Время создания: {duration}
      📅 Дата: {date}

✅ Шаблон успешно создан
📊 ID: template_backup_success_001
📋 Статус: Активен
📈 Использований: 0

📋 Доступные переменные:
   {backup_name} - имя бэкапа
   {size} - размер бэкапа
   {duration} - время создания
   {date} - дата создания

📋 Управление шаблонами:
   📋 Список: python sdb notifications template --list
   📋 Редактирование: python sdb notifications template --edit NAME
   📋 Удаление: python sdb notifications template --delete NAME
```

### `python sdb notifications schedule --cron`

Планирование регулярных уведомлений.

**Опции:**
- `--cron EXPRESSION` - cron выражение
- `--template TEMPLATE` - шаблон уведомления
- `--channel CHANNEL` - канал для отправки
- `--list` - показать расписания

**Примеры:**

```bash
# Запланировать ежедневное уведомление
python sdb notifications schedule --cron "0 9 * * *" --template daily_report

# Показать расписания
python sdb notifications schedule --list

# Запланировать еженедельное уведомление
python sdb notifications schedule --cron "0 10 * * 1" --template weekly_summary
```

**Результат:**
```
⏰ Планирование уведомлений

📋 Создание расписания:
   📝 Шаблон: daily_report
   📅 Расписание: 0 9 * * * (ежедневно в 09:00)
   📧 Канал: email
   📊 Приоритет: Нормальный

✅ Расписание успешно создано
🆔 ID: schedule_daily_report_001
📅 Следующее выполнение: 2024-01-16 09:00:00
📊 Статус: Активно

📋 Параметры расписания:
   📝 Шаблон: daily_report
   📧 Каналы: email, telegram
   📊 Приоритет: Нормальный
   📋 Условия: Всегда

📋 Управление расписаниями:
   📋 Список: python sdb notifications schedule --list
   📋 Отмена: python sdb notifications schedule --cancel ID
   📋 Редактирование: python sdb notifications schedule --edit ID
```

## Безопасность

### ❌ Критически опасные команды:
- `python sdb notifications clear --all` - очистит все настройки
- `python sdb notifications reset` - сбросит все каналы

### ⚠️ Опасные команды:
- `python sdb notifications configure` - изменит настройки каналов
- `python sdb notifications send --all` - отправит во все каналы
- `python sdb notifications schedule` - создаст новые расписания

### ✅ Безопасные команды:
- `python sdb notifications list` - только показывает каналы
- `python sdb notifications test` - только тестирует
- `python sdb notifications monitor` - только мониторинг

## Рекомендации

1. **Резервные каналы**: Настройте несколько каналов для надежности
2. **Тестирование**: Регулярно тестируйте все каналы
3. **Мониторинг**: Следите за доставкой уведомлений
4. **Шаблоны**: Используйте шаблоны для стандартизации
5. **Приоритеты**: Настройте правильные приоритеты для разных типов уведомлений

## Устранение проблем

### Проблема: "Уведомления не отправляются"
```bash
# Проверить каналы
python sdb notifications list

# Тестировать каналы
python sdb notifications test

# Проверить настройки
python sdb notifications configure --test
```

### Проблема: "Медленная доставка"
```bash
# Проверить статус каналов
python sdb notifications list --detailed

# Тестировать производительность
python sdb notifications test --verbose

# Проверить сетевые настройки
python sdb system status
```

### Проблема: "Неверные настройки"
```bash
# Переконфигурировать канал
python sdb notifications configure --email NEW_EMAIL

# Проверить токены
python sdb notifications configure --telegram NEW_TOKEN

# Тестировать после изменений
python sdb notifications test
```

## Типы уведомлений

### Системные уведомления
- Статус системы
- Ошибки и предупреждения
- Обновления системы
- Бэкапы

### Пользовательские уведомления
- Регистрация пользователей
- Изменения в аккаунте
- Уведомления о действиях
- Отчеты

### Критические уведомления
- Сбои системы
- Проблемы безопасности
- Критические ошибки
- Аварийные ситуации

## Каналы уведомлений

### Email
- Надежная доставка
- Поддержка HTML
- Возможность вложений
- Логирование

### Telegram
- Быстрая доставка
- Поддержка ботов
- Интерактивные кнопки
- Групповые чаты

 