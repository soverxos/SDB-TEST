# 💾 Управление кэшем (cache)

## Обзор

Модуль `cache` предоставляет инструменты для управления кэшированием данных в SwiftDevBot, включая мониторинг, очистку, статистику и оптимизацию кэша.

## Основные команды

### `python sdb cache status`

Показывает статус кэша и основную статистику.

**Опции:**
- `--detailed` - подробная информация
- `--json` - вывод в формате JSON
- `--memory` - информация о памяти

**Примеры:**

```bash
# Показать статус кэша
python sdb cache status

# Подробная информация
python sdb cache status --detailed

# Информация о памяти
python sdb cache status --memory
```

**Результат:**
```
💾 Статус кэша SwiftDevBot-Lite

📊 Основная информация:
   🟢 Статус: Активен
   📊 Тип: Redis
   🔗 Подключение: localhost:6379
   📈 Версия: 6.2.0

📊 Использование:
   📊 Размер кэша: 1.2GB / 2.0GB (60%)
   📊 Объектов в кэше: 5,000
   📊 Истекших объектов: 2,000
   📊 Hit rate: 85%

📊 Производительность:
   📈 Запросов/сек: 1,250
   📈 Miss rate: 15%
   📈 Evictions: 200 (за 24 часа)
   📈 Среднее время ответа: 2ms

📊 Память:
   💾 Использовано: 1.2GB
   💾 Доступно: 800MB
   💾 Peak usage: 1.5GB
   💾 Fragmentation: 5%

📋 Рекомендации:
   ✅ Кэш работает оптимально
   ⚠️ Рассмотрите увеличение размера при росте нагрузки
   🔧 Регулярно очищайте истекшие объекты
```

### `python sdb cache stats`

Показывает детальную статистику кэша.

**Опции:**
- `--period 1h/24h/7d` - период статистики
- `--keys` - статистика по ключам
- `--memory` - детальная статистика памяти

**Примеры:**

```bash
# Показать статистику
python sdb cache stats

# Статистика за последний час
python sdb cache stats --period 1h

# Статистика по ключам
python sdb cache stats --keys
```

**Результат:**
```
📊 Детальная статистика кэша

📈 Производительность (24 часа):
   📊 Hit rate: 85% (1,250,000 hits)
   📊 Miss rate: 15% (220,000 misses)
   📊 Evictions: 200 (0.02% от общего числа)
   📊 Expired: 2,000 (0.2% от общего числа)

📊 По типам данных:
   👤 User profiles: 45% (2,250 объектов)
   🧩 Module configs: 25% (1,250 объектов)
   🔗 API responses: 20% (1,000 объектов)
   📋 System data: 10% (500 объектов)

📊 По времени жизни:
   ⏱️ < 1 час: 30% (1,500 объектов)
   ⏱️ 1-24 часа: 50% (2,500 объектов)
   ⏱️ > 24 часа: 20% (1,000 объектов)

📊 Топ ключей по использованию:
   🔑 user:profile:12345: 1,250 hits
   🔑 module:config:telegram: 850 hits
   🔑 api:response:users: 650 hits
   🔑 system:settings: 450 hits

📊 Память (детально):
   💾 Used memory: 1.2GB
   💾 Peak memory: 1.5GB
   💾 Fragmentation: 5%
   💾 Memory efficiency: 95%
```

### `python sdb cache clear --all`

Очищает кэш полностью или частично.

**Опции:**
- `--all` - очистить весь кэш
- `--old` - очистить только истекшие объекты
- `--pattern PATTERN` - очистить по паттерну
- `--dry-run` - показать что будет очищено

**Примеры:**

```bash
# Очистить весь кэш
python sdb cache clear --all

# Очистить только истекшие объекты
python sdb cache clear --old

# Очистить по паттерну
python sdb cache clear --pattern "user:*"

# Показать что будет очищено
python sdb cache clear --all --dry-run
```

**Результат:**
```
🗑️ Очистка кэша

📋 Операция: Очистка всего кэша
📊 Объектов для удаления: 5,000
📊 Размер для освобождения: 1.2GB
📋 Статус: Выполняется...

✅ Кэш успешно очищен
📊 Удалено объектов: 5,000
💾 Освобождено памяти: 1.2GB
⏱️ Время выполнения: 0.5 секунды

📋 Результат:
   🟢 Кэш полностью очищен
   📊 Новый размер: 0MB
   📊 Доступная память: 2.0GB
   🔧 Кэш готов к использованию

📋 Рекомендации:
   ⚠️ Производительность может временно снизиться
   🔄 Кэш будет заполняться по мере использования
   📊 Мониторьте hit rate после очистки
```

### `python sdb cache warm`

Прогревает кэш часто используемыми данными.

**Опции:**
- `--all` - прогреть все типы данных
- `--type TYPE` - прогреть конкретный тип
- `--priority` - приоритет прогрева
- `--background` - выполнить в фоне

**Примеры:**

```bash
# Прогреть весь кэш
python sdb cache warm

# Прогреть конкретный тип
python sdb cache warm --type user_profiles

# Прогрев в фоне
python sdb cache warm --background
```

**Результат:**
```
🔥 Прогрев кэша

📋 Операция: Прогрев часто используемых данных
📊 Приоритет: Высокий
📋 Статус: Выполняется...

📊 Прогретые данные:
   👤 User profiles: 1,000 объектов (45MB)
   🧩 Module configs: 50 объектов (2MB)
   🔗 API responses: 200 объектов (15MB)
   📋 System data: 100 объектов (5MB)

✅ Кэш успешно прогрет
📊 Всего объектов: 1,350
💾 Использовано памяти: 67MB
⏱️ Время прогрева: 3.2 секунды

📊 Статистика прогрева:
   📈 Hit rate после прогрева: 95%
   📈 Среднее время ответа: 1ms
   📈 Эффективность: 98%

📋 Рекомендации:
   ✅ Кэш готов к высокой нагрузке
   🔄 Регулярно выполняйте прогрев после очистки
   📊 Мониторьте производительность
```

## Расширенные команды (в разработке)

### `python sdb cache optimize --auto`

Автоматическая оптимизация кэша.

**Опции:**
- `--auto` - автоматическая оптимизация
- `--analyze` - анализ производительности
- `--tune` - настройка параметров

**Примеры:**

```bash
# Автоматическая оптимизация
python sdb cache optimize --auto

# Анализ производительности
python sdb cache optimize --analyze

# Настройка параметров
python sdb cache optimize --tune
```

**Результат:**
```
🔧 Автоматическая оптимизация кэша

📋 Анализ производительности:
   📊 Неэффективные ключи: 150
   📊 Избыточные данные: 200MB
   📊 Неоптимальные TTL: 50 объектов
   📊 Фрагментация памяти: 8%

📊 Оптимизации:
   ✅ Удалены неэффективные ключи: 150
   ✅ Освобождено избыточных данных: 200MB
   ✅ Оптимизированы TTL: 50 объектов
   ✅ Уменьшена фрагментация: 8% → 3%

📈 Результаты оптимизации:
   📊 Hit rate: +5% (85% → 90%)
   📊 Использование памяти: -15% (1.2GB → 1.0GB)
   📊 Среднее время ответа: -20% (2ms → 1.6ms)
   📊 Эффективность: +8%

📋 Рекомендации:
   🔄 Регулярно выполняйте оптимизацию
   📊 Настройте автоматическую оптимизацию
   🔧 Мониторьте производительность
```

### `python sdb cache monitor --real-time`

Мониторинг кэша в реальном времени.

**Опции:**
- `--real-time` - мониторинг в реальном времени
- `--dashboard` - веб-интерфейс мониторинга
- `--alerts` - настройка алертов

**Примеры:**

```bash
# Мониторинг в реальном времени
python sdb cache monitor --real-time

# Веб-интерфейс мониторинга
python sdb cache monitor --dashboard

# Настройка алертов
python sdb cache monitor --alerts
```

**Результат:**
```
📊 Мониторинг кэша в реальном времени

📋 Текущие метрики:
   📊 Hit rate: 85% (1,250 req/sec)
   📊 Memory usage: 1.2GB / 2.0GB (60%)
   📊 Active connections: 12
   📊 Evictions: 5 (за последний час)

📊 Статистика (24 часа):
   📈 Общее количество запросов: 10,800,000
   📈 Успешных попаданий: 9,180,000
   📈 Промахов: 1,620,000
   📈 Evictions: 200

🔔 Алерты:
   🟢 Кэш работает нормально
   ⚠️ Hit rate ниже оптимального (рекомендуется >90%)
   📊 Память используется эффективно

📋 Рекомендации:
   🔧 Рассмотрите увеличение размера кэша
   📊 Оптимизируйте часто используемые ключи
   🔄 Настройте автоматическую очистку
```

### `python sdb cache backup --create`

Создание резервной копии кэша.

**Опции:**
- `--create` - создать бэкап
- `--restore` - восстановить из бэкапа
- `--list` - показать бэкапы
- `--compress` - сжать бэкап

**Примеры:**

```bash
# Создать бэкап кэша
python sdb cache backup --create

# Восстановить из бэкапа
python sdb cache backup --restore backup_20240115

# Показать бэкапы
python sdb cache backup --list
```

**Результат:**
```
💾 Резервное копирование кэша

📋 Создание бэкапа:
   📁 Имя: cache_backup_20240115_143022
   📊 Объектов: 5,000
   📊 Размер: 1.2GB
   📋 Статус: Выполняется...

✅ Бэкап успешно создан
📊 Сохранено объектов: 5,000
💾 Размер файла: 1.1GB (сжатие: 8%)
⏱️ Время создания: 15 секунд

📋 Информация о бэкапе:
   📅 Создан: 2024-01-15 14:30:22
   📊 Тип: Полный бэкап
   🔐 Шифрование: Нет
   📁 Расположение: /backup/cache/

📋 Управление бэкапами:
   📋 Список бэкапов: python sdb cache backup --list
   📋 Восстановление: python sdb cache backup --restore NAME
   📋 Удаление: python sdb cache backup --delete NAME
```

## Безопасность

### ❌ Критически опасные команды:
- `python sdb cache clear --all` - удалит все данные кэша
- `python sdb cache reset` - сбросит все настройки кэша

### ⚠️ Опасные команды:
- `python sdb cache clear --old` - удалит истекшие объекты
- `python sdb cache optimize --auto` - может изменить настройки

### ✅ Безопасные команды:
- `python sdb cache status` - только показывает статус
- `python sdb cache stats` - только показывает статистику
- `python sdb cache warm` - только прогревает кэш
- `python sdb cache monitor` - только мониторинг

## Рекомендации

1. **Регулярная очистка**: Очищайте истекшие объекты еженедельно
2. **Прогрев кэша**: Прогревайте кэш после очистки или перезапуска
3. **Мониторинг**: Следите за hit rate и производительностью
4. **Оптимизация**: Регулярно оптимизируйте настройки кэша
5. **Бэкапы**: Создавайте бэкапы важных данных кэша

## Устранение проблем

### Проблема: "Низкий hit rate"
```bash
# Проверить статистику
python sdb cache stats

# Прогреть кэш
python sdb cache warm

# Оптимизировать настройки
python sdb cache optimize --analyze
```

### Проблема: "Высокое использование памяти"
```bash
# Проверить статус
python sdb cache status --memory

# Очистить истекшие объекты
python sdb cache clear --old

# Оптимизировать кэш
python sdb cache optimize --auto
```

### Проблема: "Медленные ответы"
```bash
# Проверить производительность
python sdb cache stats

# Прогреть кэш
python sdb cache warm

# Проверить подключение
python sdb cache status
```

## Типы данных в кэше

### Пользовательские данные
- Профили пользователей
- Настройки пользователей
- Сессии пользователей

### Системные данные
- Конфигурации модулей
- Настройки системы
- Метаданные

### API данные
- Ответы API
- Результаты запросов
- Временные данные

### Кэшированные вычисления
- Результаты сложных вычислений
- Агрегированные данные
- Статистика

## Параметры кэша

### Общие параметры
- `max_memory` - максимальный размер памяти
- `ttl` - время жизни объектов
- `max_connections` - максимальное количество соединений
- `eviction_policy` - политика вытеснения

### Специфичные параметры
- `compression` - сжатие данных
- `persistence` - сохранение на диск
- `replication` - репликация
- `security` - настройки безопасности 